---
title: "radar script"
output:
  html_document: default
  pdf_document: default
bibliography: Andrea.bib
csl: apa.csl
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


##### **RaDAr**

In this section we will use the library *RadAR* (Radiomics Analysis with R). This is a software to perform comprehensive analysis of radiomic features. RadAR allows the users to carry out the entire processing of radiomic datasets, from data import to feature processing and visualization and implements multiple statistical methods for the analysis of these data.

First we load the *RadAR* library.
```{r, message=FALSE, results='hide', warning=FALSE}
library(RadAR)
```


With *RadAR* we can import the radiomic features that we extracted before using pyradiomics.

<span style="color:red">TO DO: explain normalizacion y shift, y con normalizacion.</span>

We will create the *rdr* object with normalization and shift, and another one with normalization only. We use the function *import_pyradiomics(path_to_folder)* to import the results we obtained using pyradiomics, where *path_to_folder* is the path to the folder containing the pyradiomics csv files. The function filters out duplicated feature names. 

```{r, eval = FALSE}
rdr_NormShift <- import_pyradiomics(dir="/Users/andrealetaalfonso/Desktop/TFG/A_Project/results/ECLIPSE_results_ParamsNormShiftCSV")
```

```{r, include=FALSE}
rdr_NormShift <- import_pyradiomics(dir="/Users/andrealetaalfonso/Desktop/TFG/A_Project/results/ECLIPSE_results_ParamsNormShiftCSV")
```

```{r, eval = FALSE}
rdr_Norm <- import_pyradiomics(dir="/Users/andrealetaalfonso/Desktop/TFG/A_Project/results/ECLIPSE_results_ParamsNormCSV")
```

```{r, include=FALSE}
rdr_Norm <- import_pyradiomics(dir="/Users/andrealetaalfonso/Desktop/TFG/A_Project/results/ECLIPSE_results_ParamsNormCSV")
```

```{r}
rdr_NormShift
```

```{r}
rdr_Norm
```


The *rdr* object is a *SummarizedExperiment*.

<span style="color:red">TO DO: explain more & add image SummarizedExperiment</span>

The available clinical data can be also imported in the *rdr* object.

We can extract the data with the function *assay()*.
```{r}
data <- assay(rdr_NormShift)
data[1:10,1:2]
```

```{r}
data2 <- assay(rdr_Norm)
data2[1:10,1:2]
```

We can check which image types (i.e., normal or wavelet filtered) features have been extracted from.
```{r}
print_image_type(rdr = rdr_NormShift)
```

The *rdr* object can be also filter by feature type.
```{r}
print_feature_type(rdr = rdr_NormShift)
```

To access to the elements of patients (columns) or features (rows) we can do:
```{r}
names(colData(rdr_NormShift)) # columns
names(rowData(rdr_NormShift)) # rows
```


**Correlation matrix**

Visualize the correlation matrix:
```{r, out.width="70%"}
plot_correlation_matrix(rdr = rdr_NormShift, 
                        method_correlation = "spearman", 
                        view_as = "heatmap", 
                        which_data = "normal")
```


A different way to visualize the correlation matrix is by using correlation plot:
```{r, out.width="70%"}
plot_correlation_matrix(rdr = rdr_NormShift, 
                        method_correlation = "pearson", 
                        view_as = "corrplot", 
                        which_data = "normal")
```


**Pre-processing and visualization of radiomic features**

Scale features:
```{r}
rdr_scaled <- scale_feature_values(rdr = rdr_NormShift, method = "minmax")
```

Group features:
```{r}
rdr <- do_hierarchical_clustering(rdr = rdr_scaled, 
                                  which_data = "scaled", 
                                  method_dist_col = "correlation.spearman")

```

Heat map:
```{r, out.width="70%"}
plot_heatmap_hcl(rdr = rdr) 
```

We can also save the rdr object to *.rda*.
```{r}
save(rdr_NormShift, file = "rdr_Andrea_NormShift.rda")
```
```{r}
save(rdr_Norm, file = "rdr_Andrea_Norm.rda")
```


We can open the *.rda* file with the following code:
```{r, warning=FALSE}
library(admisc)
test_NormShift <- listRDA("rdr_Andrea_NormShift.rda")
test_NormShift
```
```{r}
test_Norm <- listRDA("rdr_Andrea_Norm.rda")
test_Norm
```


